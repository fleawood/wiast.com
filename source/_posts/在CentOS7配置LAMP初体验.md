---
title: 在CentOS7配置LAMP初体验
categories:
  - web服务器
date: 2016-09-26 23:24:33
tags:
---

上次咱们提到了LilyStudio的新人练手项目，但具体内容我没有详细说明。其实项目就是做一个问答网站，咱们技术组要做的就是负责网站服务器的搭建，以及后端的处理。以前也都是看别人搭建服务器，就觉得特别厉害，没想到有一天自己也要做相同的事。不过说到搭服务器，感觉千头万绪，到底从哪开始呢？组长提到了LAMP，今儿就上网去看了下，原来是Linux+Apache+Mysql/MariaDB+Perl/PHP/Python的缩写，Linux是系统，Apache是服务器，Mysql/MariaDB是数据库，Perl/PHP/Python是脚本语言，综合在一起就能搭起一个web平台了。

<!--more-->

前面都是扯淡，下面进入正题。Linux之前已经装了Fedora，但是上网一看好像CentOS更流行做服务器，那就再装一个虚拟机吧，反正教育网镜像下载速度飞快，一度可达8M/s。然后又是大家熟悉的装虚拟机环节了，这个因为在PA和oslab已经装过好几遍，应该说是毫无压力。不过第一遍装的时候只装了CLI，结果用起来有点蛋疼，虽然不是没用过，而且可以考虑用putty改善体验，但是总感觉有点不舒服。强迫症发作的我于是又把虚拟机删了重装。装GUI果然是费时多了，从500+个项目一下增加到1200+，不过其实也就多花几分钟的事。好了终于看见了熟悉的GUI界面，咦，这界面咋和Fedora有点像呢？原来他们都是基于Red Hat的发行版。

CentOS装好了，接下来要装软件了。上网搜了一下，有一些方案是一键打包安装的，另一些则是手动一个个装好的。本着初学者钻研的态度，当然还有迷之自信，我选择自己一个个安装。其实这也没有什么难的地方，只是要知道自己每一步该做什么。首先我们需要安装搭建服务器所需的软件包，目前就是apache, mysql和PHP这三个了。

装好之后，先启动一下apache服务看看是否成功。这时就遇到了第一个问题，网上告诉我启动的命令是`/etc/rc.d/init.d/httpd start`，可是输入之后系统告诉我并没有`/etc/rc.d/init.d/httpd`这个文件。这就奇怪了，于是我进入`/etc/rc.d/init.d/httpd`目录底下查看，发现确实没有`httpd`这个文件，不过有个`README`，那就去看看吧。结果一看，它说传统的初始化脚本已经被系统原生服务代替了，还告诉我可以用`systemctl start`命令来启动服务。既然都这么说了，咱们就试一试。于是我就输入了`systemctl start httpd`，结果还真有反应，系统提示我需要管理员权限。输完密码，等待执行完成之后，用`ps aux | grep httpd`查看当前运行的进程，确实看见了httpd的身影，这个问题就解决了。

接下来轮到检验PHP了，彼时我还不知道默认的网站目录在哪，在地址栏输入localhost或者127.0.0.1就能看到一个服务器启动之后自带的初始网页，看上去还颇为酷炫。然后我尝试自己新建了一个php文件，然后用浏览器输入绝对路径打开它，发现这样做并不能解析php，浏览器只会当作是文件来下载。本来以为是因为初始网页的问题，于是修改了`/etc/httpd/conf/welcome.conf`这个文件，发现这回直接就没东西了，直接显示目录。上网搜索才得知，原来默认的网站目录放在`/var/www/html/`下，于是我就在这个目录下新建了一个php文件，然而只显示了文件，必须改名叫`index.php`，服务器才会自动加载上去（当然，主页文件名不一定要是index.\*，这是可以更改的）。

最后就是启动Mysql了。欸，`systemctl start mysqld`怎么运行不起来？仔细一检查，就根本没有mysql-server这个软件包。原来从CentOS7开始移除了Mysql，而用MariaDB代替了。既然如此，那就只好去用MariaDB吧。装好MariaDB之后，按照网上的说明，先进行`mysql_secure_installation`设置一下root密码和别的一些东西。然后`mysql -u root -p`，输入密码之后就可以进入数据库了。在数据库晃悠了一圈，然而我并看不懂里面的东西，也不知道该做些啥操作。赶紧又去搜了一下，找了个最简单的代码检查是否能和数据库连接，效果显著。这下三个部分就都检验好了。

其实到这里服务器的搭建也就差不多完了，然而想到网站的目录一直在`/var/www/html`底下，感觉有点不舒服，于是就打算更改默认目录。谁能想到这是作死的开始。在`/etc/httpd/conf/httpd.conf`里改完之后，我尝试重启httpd服务，结果遇到了意想不到的403 Forbidden错误，提示我没有权限。这玩意儿有点厉害的，上网搜索了半天，有说是文件权限要改为755的，有说要停止SELinux服务的，有说是`httpd.conf`里配置问题的，可是尝试了各种方法，重启多次apache，依然毫无进展。后来看到有人说，把启动apache的用户和组更改为当前用户就可以了，我试了一下，果然成功返回了网页。不过这是怎么回事呢？结合了stackoverflow上的一个回答，我大概知道了原因。其实是因为我把网站目录建在我个人用户的主目录底下了，而apache服务默认是由apache这个所谓的用户启动的，而用户主目录默认权限是700，用户apache当然不能访问到我主目录底下的网站。这也解释了原来放在`/var/www/html`底下不会有啥问题，以及把启动apache的用户改成自己就能成功看到网页这两个奇怪的现象。解决办法也很简单，不要把网站建在用户目录下就可以了。

最后，请允许我用php的hello world作结尾，聊以慰藉那些摸索中度过的时光。

    <?php
    echo "hello, world";
    ?>
