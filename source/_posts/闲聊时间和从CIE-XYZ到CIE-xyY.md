---
title: 闲聊时间和从CIE XYZ到CIE xyY
categories:
  - 个人评论
  - 色彩空间
date: 2016-11-07 23:45:47
tags:
---

一段时间没有更新网站了，当然是因为没心情。最近忙了一些事，从新人练手项目，CCPC，到组合数学、随机算法作业，还有在主机上装CentOS差点没法启动win10的经历，最近又开始了半年前埋下祸根的创新项目，眼看着这学期已然过去一半，麻烦事总是一件接一件的到来。想到各方面的队友们不堪一击的战斗力，有时就感觉到深深的无力。实在是带不动。

<!--more-->

其实我也很希望成为在各方面独当一面的人物，成为队友依赖的对象。但是毕竟我并非全能，而且还有不少课业，我已经是以一种偷工减料的方式挣扎着用大把时间花在课外的项目上，虽然之前几个学期都是这么做的，但这总归是权宜之计，这样学到的东西基础往往都不牢靠，即使考试得了高分，在将来也是后患无穷。这一点我已经在某些方面有所体会。

前一阵子在食堂吃饭时突然体会到，其实拔尖班的教学安排用意颇深。众所周知，拔尖班重理论轻实践，几乎完全不教人和写代码相关的任何知识。美其名曰让大家自学，其实就是放任大家自生自灭。所以除非自己有额外的训练和实践，拔尖班的同学们代码能力都不强。唯一所知只有C++，还是仅限于结构化的部分，就连这些都要感谢kwc助教一学期的大力辅导。于是这些人出来之后肯定是毫无竞争力了，就像等待被屠杀的羔羊一样无助。不过现实也不是完全无望，其实还有一条出路，就是保研do research，正好系里面也给拔尖班同学们对口了颇为优惠的保研政策，平均分75即可。一方面提高了保研率，另一方面也培养了科研方向的“后备人才”，还有大把的专项经费，真是一举多得。

有时突然会想到一些人，身边总是有不少牛人谈笑风生，路子也很广，总给人感觉很厉害的样子。但是实际上他们并不强，至少不是顶尖的那部分人。<span style="color: #ffffff;">（没错，我指的就是某些妹子）</span>也许算是一种人际交往方面的能力吧，这也正是我所不擅长的。但是我不喜欢这种人，这些人外强中干，徒有其表。也许他们能出色的完成任务，但大多数情况下，他们不过是拜托了另一位大牛代劳。他们用着精湛的交往能力在纷繁杂乱的事务间出入自如，广受好评，但问题的真正解决与他们关系并不大。这个社会其实现实得很，有能力者身边必然聚集一帮狐朋狗友，一旦不再受人需要，很快就打入冷宫。<span style="color: #ffffff;"><cite>冰菓</cite>里就有这么一个人。</span>

下面回归正题。这两天我打算进展一下创新项目，目前打算对一个图像（一帧）进行污染，[paper](http://www.cs.iit.edu/~xli/paper/Conf/kaleido-mobicom15.pdf)里说了Illuminance Frame Pollution和Chromatic Frame Decomposition，翻译过来大概是亮度污染和色度分解的意思。本来以为并不太难，然而后来仔细看的时候才发现，这玩意儿是在CIE xyY颜色空间里做的变换，但是一般我们处理图像都是在RGB颜色空间里做的。于是我赶紧去学习了一下CIE xyY颜色空间，看wiki，中文的没看懂，英文的也没看懂。于是又去其他地方看了一些英文文章，好不容易看出个大概。可是实践的时候又出了问题，opencv里没有RGB向CIE xyY空间的直接转换，于是我又去研究了一波CIE XYZ和CIE xyY的关系。然而还是颇有问题，都说CIE XYZ和CIE xyY用的是同一个Y，而且都代表亮度，但是我直接修改CIE XYZ中的Y值，得到的新图并不是仅仅改变亮度，而是连色调都变了，这就奇怪了。百思不得其解，又去找了新的文章看，还是没明白。就在前几个小时，我突然想到paper里说的是CIE xyY空间，而我工作在CIE XYZ空间下，直接改Y会导致xy的数值发生变化，也就是说得到的不是原来的颜色了。所以不仅要修改Y，X和Z也要相应修改。但是具体要怎么做呢？研究了半天，我发现这其实是个简单的数学问题。

***

对于原图中某个像素，在CIE XYZ颜色空间中表示为(X, Y, Z)，对应在CIE xyY颜色空间中表示为(x, y, Y)，有如下关系

$ x = \frac{X}{X+Y+Z}$
$ y = \frac{Y}{X+Y+Z}$

那么对于新图中的同一像素，在CIE XYZ颜色空间中表示为(X', Y', Z')，对应在CIE xyY颜色空间中表示为(x, y, Y')，那么有如下关系

$ x = \frac{X'}{X'+Y'+Z'}$
$ y = \frac{Y'}{X'+Y'+Z'}$

现在已知x, y, Y'，马上就能解得

$ X' = \frac{x}{y} * Y'$
$ Z' = \frac{Y'}{y} - X' - Y'$

举例来说，当取Y' = 0的时候，X'和Z'也要取0，此时的图像就是纯黑的。把这个公式再应用到程序后，终于得到了调整亮度的效果，真是太不容易了。不得不说虽然网上关于CIE颜色空间的文章不少，但是对于从CIE XYZ到CIE xyY的具体转换，还有在上面进行的其他变换操作，就只有靠自己理解整个知识体系才能了解。

在这个过程中，我有十几个小时都在反复看类似的材料，还有好几个小时在进行着（几乎无用的）调试，但关键的其实就是脑子里的灵光一现，写出来也就两三行代码。那是否意味着之前的努力都白费了呢？也许是，也许不是。但局外人只会看到最后的成果，还以为你偷懒就只写了一点点。这其中的道理，真是不能多说。
